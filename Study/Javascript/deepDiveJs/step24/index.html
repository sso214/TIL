<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>24장. 클로저 | sso214&#39;s TIL</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Today I Learned">
    
    <link rel="preload" href="/TIL/assets/css/0.styles.dd5ac3b9.css" as="style"><link rel="preload" href="/TIL/assets/js/app.9bee923c.js" as="script"><link rel="preload" href="/TIL/assets/js/2.e5153bce.js" as="script"><link rel="preload" href="/TIL/assets/js/66.8402813f.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.96c1a137.js"><link rel="prefetch" href="/TIL/assets/js/100.41b4f1f9.js"><link rel="prefetch" href="/TIL/assets/js/101.99720bb5.js"><link rel="prefetch" href="/TIL/assets/js/102.43ed3760.js"><link rel="prefetch" href="/TIL/assets/js/103.777fca0a.js"><link rel="prefetch" href="/TIL/assets/js/104.e0fd6889.js"><link rel="prefetch" href="/TIL/assets/js/105.a37f6f64.js"><link rel="prefetch" href="/TIL/assets/js/106.a7bff6fd.js"><link rel="prefetch" href="/TIL/assets/js/107.8e413a2d.js"><link rel="prefetch" href="/TIL/assets/js/108.ab860d91.js"><link rel="prefetch" href="/TIL/assets/js/109.f81c2ebc.js"><link rel="prefetch" href="/TIL/assets/js/11.99afb125.js"><link rel="prefetch" href="/TIL/assets/js/110.758c6f73.js"><link rel="prefetch" href="/TIL/assets/js/111.11ece66b.js"><link rel="prefetch" href="/TIL/assets/js/112.6ee5e44f.js"><link rel="prefetch" href="/TIL/assets/js/113.a165a5cf.js"><link rel="prefetch" href="/TIL/assets/js/114.db3e68dc.js"><link rel="prefetch" href="/TIL/assets/js/115.60ed61cb.js"><link rel="prefetch" href="/TIL/assets/js/116.50a919e8.js"><link rel="prefetch" href="/TIL/assets/js/117.067dfbf2.js"><link rel="prefetch" href="/TIL/assets/js/118.e66a8849.js"><link rel="prefetch" href="/TIL/assets/js/119.7665eabc.js"><link rel="prefetch" href="/TIL/assets/js/12.c8d94d1d.js"><link rel="prefetch" href="/TIL/assets/js/120.1be3487f.js"><link rel="prefetch" href="/TIL/assets/js/121.e634a96e.js"><link rel="prefetch" href="/TIL/assets/js/122.f01b7598.js"><link rel="prefetch" href="/TIL/assets/js/123.de1a66b2.js"><link rel="prefetch" href="/TIL/assets/js/124.2db6e796.js"><link rel="prefetch" href="/TIL/assets/js/125.11612c69.js"><link rel="prefetch" href="/TIL/assets/js/126.6c67d8ef.js"><link rel="prefetch" href="/TIL/assets/js/127.5f28e23b.js"><link rel="prefetch" href="/TIL/assets/js/128.17ef4bd4.js"><link rel="prefetch" href="/TIL/assets/js/129.e8b293d2.js"><link rel="prefetch" href="/TIL/assets/js/13.8e3b28f9.js"><link rel="prefetch" href="/TIL/assets/js/130.78c3a27a.js"><link rel="prefetch" href="/TIL/assets/js/131.24b4ce26.js"><link rel="prefetch" href="/TIL/assets/js/132.ee229abf.js"><link rel="prefetch" href="/TIL/assets/js/133.1834c440.js"><link rel="prefetch" href="/TIL/assets/js/134.8423ec9b.js"><link rel="prefetch" href="/TIL/assets/js/135.a23a0288.js"><link rel="prefetch" href="/TIL/assets/js/136.643bd62e.js"><link rel="prefetch" href="/TIL/assets/js/137.18c10881.js"><link rel="prefetch" href="/TIL/assets/js/138.dce9efa8.js"><link rel="prefetch" href="/TIL/assets/js/139.ca92cd6d.js"><link rel="prefetch" href="/TIL/assets/js/14.1fe39c87.js"><link rel="prefetch" href="/TIL/assets/js/140.46a21e22.js"><link rel="prefetch" href="/TIL/assets/js/141.b986502c.js"><link rel="prefetch" href="/TIL/assets/js/142.d7ee3c1d.js"><link rel="prefetch" href="/TIL/assets/js/15.a0460a6a.js"><link rel="prefetch" href="/TIL/assets/js/16.fcb082d8.js"><link rel="prefetch" href="/TIL/assets/js/17.8c442d4c.js"><link rel="prefetch" href="/TIL/assets/js/18.857b8f53.js"><link rel="prefetch" href="/TIL/assets/js/19.76fe55f2.js"><link rel="prefetch" href="/TIL/assets/js/20.186e629f.js"><link rel="prefetch" href="/TIL/assets/js/21.78e259c2.js"><link rel="prefetch" href="/TIL/assets/js/22.b69cf6df.js"><link rel="prefetch" href="/TIL/assets/js/23.011ff92a.js"><link rel="prefetch" href="/TIL/assets/js/24.b2a3de78.js"><link rel="prefetch" href="/TIL/assets/js/25.b59b9f2f.js"><link rel="prefetch" href="/TIL/assets/js/26.28a13163.js"><link rel="prefetch" href="/TIL/assets/js/27.36732435.js"><link rel="prefetch" href="/TIL/assets/js/28.028393d3.js"><link rel="prefetch" href="/TIL/assets/js/29.bd09bf57.js"><link rel="prefetch" href="/TIL/assets/js/3.67f4b115.js"><link rel="prefetch" href="/TIL/assets/js/30.7e7b16b6.js"><link rel="prefetch" href="/TIL/assets/js/31.543b9b3a.js"><link rel="prefetch" href="/TIL/assets/js/32.ba941ae4.js"><link rel="prefetch" href="/TIL/assets/js/33.fd29722b.js"><link rel="prefetch" href="/TIL/assets/js/34.0b0a2238.js"><link rel="prefetch" href="/TIL/assets/js/35.e51c15c7.js"><link rel="prefetch" href="/TIL/assets/js/36.eb33126c.js"><link rel="prefetch" href="/TIL/assets/js/37.0d37632b.js"><link rel="prefetch" href="/TIL/assets/js/38.dc529a56.js"><link rel="prefetch" href="/TIL/assets/js/39.7317284c.js"><link rel="prefetch" href="/TIL/assets/js/4.e52e661e.js"><link rel="prefetch" href="/TIL/assets/js/40.80b4d635.js"><link rel="prefetch" href="/TIL/assets/js/41.7e316f61.js"><link rel="prefetch" href="/TIL/assets/js/42.2bc373d3.js"><link rel="prefetch" href="/TIL/assets/js/43.da6ff52e.js"><link rel="prefetch" href="/TIL/assets/js/44.41a910a6.js"><link rel="prefetch" href="/TIL/assets/js/45.7a9cb95b.js"><link rel="prefetch" href="/TIL/assets/js/46.72d40211.js"><link rel="prefetch" href="/TIL/assets/js/47.022571e7.js"><link rel="prefetch" href="/TIL/assets/js/48.2b3d1ae2.js"><link rel="prefetch" href="/TIL/assets/js/49.9e178f56.js"><link rel="prefetch" href="/TIL/assets/js/5.e68a1f97.js"><link rel="prefetch" href="/TIL/assets/js/50.b4a36dca.js"><link rel="prefetch" href="/TIL/assets/js/51.752cc698.js"><link rel="prefetch" href="/TIL/assets/js/52.a2e80fc8.js"><link rel="prefetch" href="/TIL/assets/js/53.a4239d4d.js"><link rel="prefetch" href="/TIL/assets/js/54.ba6d131f.js"><link rel="prefetch" href="/TIL/assets/js/55.d9b9b566.js"><link rel="prefetch" href="/TIL/assets/js/56.96352b74.js"><link rel="prefetch" href="/TIL/assets/js/57.bd2d8ca4.js"><link rel="prefetch" href="/TIL/assets/js/58.bb6a1f1d.js"><link rel="prefetch" href="/TIL/assets/js/59.a9749da8.js"><link rel="prefetch" href="/TIL/assets/js/6.852d803a.js"><link rel="prefetch" href="/TIL/assets/js/60.dd126a97.js"><link rel="prefetch" href="/TIL/assets/js/61.0b5b3958.js"><link rel="prefetch" href="/TIL/assets/js/62.e194fb46.js"><link rel="prefetch" href="/TIL/assets/js/63.d36aa07b.js"><link rel="prefetch" href="/TIL/assets/js/64.026aac8d.js"><link rel="prefetch" href="/TIL/assets/js/65.bf432bdc.js"><link rel="prefetch" href="/TIL/assets/js/67.6f4203a8.js"><link rel="prefetch" href="/TIL/assets/js/68.7d5e52f8.js"><link rel="prefetch" href="/TIL/assets/js/69.515f9943.js"><link rel="prefetch" href="/TIL/assets/js/7.9c4b094e.js"><link rel="prefetch" href="/TIL/assets/js/70.30d83c44.js"><link rel="prefetch" href="/TIL/assets/js/71.bb4dd881.js"><link rel="prefetch" href="/TIL/assets/js/72.1685a445.js"><link rel="prefetch" href="/TIL/assets/js/73.7f588113.js"><link rel="prefetch" href="/TIL/assets/js/74.17804d38.js"><link rel="prefetch" href="/TIL/assets/js/75.51b63f63.js"><link rel="prefetch" href="/TIL/assets/js/76.16581fe5.js"><link rel="prefetch" href="/TIL/assets/js/77.ddb4fd13.js"><link rel="prefetch" href="/TIL/assets/js/78.811ec7f2.js"><link rel="prefetch" href="/TIL/assets/js/79.41f5daf8.js"><link rel="prefetch" href="/TIL/assets/js/8.7a8d8547.js"><link rel="prefetch" href="/TIL/assets/js/80.a4fb4753.js"><link rel="prefetch" href="/TIL/assets/js/81.949f3c7d.js"><link rel="prefetch" href="/TIL/assets/js/82.a9f44996.js"><link rel="prefetch" href="/TIL/assets/js/83.55f5af31.js"><link rel="prefetch" href="/TIL/assets/js/84.5985544d.js"><link rel="prefetch" href="/TIL/assets/js/85.cfe55fdd.js"><link rel="prefetch" href="/TIL/assets/js/86.99f699f9.js"><link rel="prefetch" href="/TIL/assets/js/87.2fe8f78e.js"><link rel="prefetch" href="/TIL/assets/js/88.80aee48c.js"><link rel="prefetch" href="/TIL/assets/js/89.4c9efe26.js"><link rel="prefetch" href="/TIL/assets/js/9.8863fc90.js"><link rel="prefetch" href="/TIL/assets/js/90.2f85e60a.js"><link rel="prefetch" href="/TIL/assets/js/91.b1930d3e.js"><link rel="prefetch" href="/TIL/assets/js/92.6dc44a59.js"><link rel="prefetch" href="/TIL/assets/js/93.0b31f53a.js"><link rel="prefetch" href="/TIL/assets/js/94.dfb1ecbd.js"><link rel="prefetch" href="/TIL/assets/js/95.fdcb4e89.js"><link rel="prefetch" href="/TIL/assets/js/96.974714ab.js"><link rel="prefetch" href="/TIL/assets/js/97.b5a3630b.js"><link rel="prefetch" href="/TIL/assets/js/98.bc2fc8a0.js"><link rel="prefetch" href="/TIL/assets/js/99.90601abe.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.dd5ac3b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><!----> <span class="site-name">sso214's TIL</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/TIL/study/" class="nav-link">
  Study
</a></div><div class="nav-item"><a href="/TIL/log/" class="nav-link">
  Log
</a></div><div class="nav-item"><a href="/TIL/memo/" class="nav-link">
  Memo
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="sso214" class="dropdown-title"><span class="title">sso214</span> <span class="arrow down"></span></button> <button type="button" aria-label="sso214" class="mobile-dropdown-title"><span class="title">sso214</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/TIL/info/" class="nav-link">
  Info
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/sso214" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/TIL/study/" class="nav-link">
  Study
</a></div><div class="nav-item"><a href="/TIL/log/" class="nav-link">
  Log
</a></div><div class="nav-item"><a href="/TIL/memo/" class="nav-link">
  Memo
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="sso214" class="dropdown-title"><span class="title">sso214</span> <span class="arrow down"></span></button> <button type="button" aria-label="sso214" class="mobile-dropdown-title"><span class="title">sso214</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/TIL/info/" class="nav-link">
  Info
</a></li><li class="dropdown-item"><!----> <a href="https://github.com/sso214" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/TIL/Study/" aria-current="page" class="sidebar-link">Study</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Canvas</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Django</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Etc</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Javascript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ReactNative</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nodeJs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_24장-클로저"><a href="#_24장-클로저" class="header-anchor">#</a> 24장. 클로저</h1> <ul><li>자바스크립트 고유의 개념이 아니라 함수형 프로그래밍 언어에서 사용되는 중요한 특성</li> <li>함수와 그 <strong>함수가 선언된 렉시컬 환경</strong>과의 조합</li> <li>자바스크립트는 렉시컬 스코프를 따르는 프로그래밍 언어</li></ul> <h2 id="_1-렉시컬-스코프-정적-스코프"><a href="#_1-렉시컬-스코프-정적-스코프" class="header-anchor">#</a> 1. 렉시컬 스코프 (정적 스코프)</h2> <ul><li><p><strong>자바스크립트 엔진은 함수를 어디에 정의했는지에 따라 상위 스코프를 결정함</strong><br>
함수를 어디서 호출하는지는 함수의 상위 스코프 결정에 어떤 영향도 주지 않음<br>
즉, 함수의 상위 스코프는 함수를 정의한 위치에 의해 정적으로 결정되고 변하지 않음</p></li> <li><p><strong>렉시컬 환경의 '외부 렉시컬 환경에 대한 참조'에 저장할 참조 값(=상위 스코프에 대한 참조)은<br>
함수 정의가 평가되는 시점에 함수가 정의된 위치에 의해 결정됨</strong><br>
스코프의 실체 = 실행 컨텍스트의 렉시컬 환경<br>
렉시컬 환경은 자신의 '외부 렉시컬 환경에 대한 참조'를 통해 상위 렉시컬 환경과 연결됨 (=스코프 체인)<br>
(렉시컬 환경의 '외부 렉시컬 환경에 대한 참조'에 저장할 참조 값 = 상위 렉시컬 환경에 대한 참조 = 상위 스코프)</p></li></ul> <h2 id="_2-함수-객체의-내부-슬롯-environment"><a href="#_2-함수-객체의-내부-슬롯-environment" class="header-anchor">#</a> 2. 함수 객체의 내부 슬롯 [[Environment]]</h2> <ul><li><p><strong>함수는 자신의 내부 슬롯 [[Environment]]에 자신이 정의된 환경(=상위 스코프)의 참조를 저장함</strong><br>
렉시컬 스코프가 가능하려면 함수는 자신이 정의된 환경을 기억해야 하기 때문에 함수 객체 생성 시<br>
자신이 정의된 환경(위치)에 의해 결정된 상위 스코프의 참조(=현재 실행 중인 실행 컨텍스트의 렉시컬 환경)를<br>
함수 객체 자신의 내부 슬롯 [[Environment]]에 저장함</p></li> <li><p><strong>상위 스코프<br>
= 내부 슬롯 [[Environment]]에 저장된 현재 실행 중인 실행 컨텍스트의 렉시컬 환경의 참조<br>
= 자신이 호출되었을 때 생성될 함수 렉시컬 환경의 '외부 렉시컬 환경에 대한 참조'에 저장될 값</strong></p></li> <li><p><strong>함수 객체는 자신이 존재하는 한 내부 슬롯 [[Environment]]에 저장한 상위 스코프를 기억함</strong></p></li> <li><p><strong>외부 렉시컬 환경에 대한 참조에는 함수 객체의<br>
내부 슬롯 [[Environment]]에 저장된 렉시컬 환경의 참조가 할당됨</strong><br>
이것이 바로 함수 정의 위치에 따라 상위 스코프를 결정하는 렉시컬 스코프의 실체</p></li></ul> <h2 id="_3-클로저와-렉시컬-환경"><a href="#_3-클로저와-렉시컬-환경" class="header-anchor">#</a> 3. 클로저와 렉시컬 환경</h2> <p><strong>외부 함수보다 중첩 함수가 더 오래 유지되는 경우 중첩 함수는 이미 생명주기가 종료한<br>
외부 함수의 변수를 참조 가능함. 이런 중첩 함수를 클로저라고 부름</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">inner</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> inner<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//outer 함수를 호출하면 중첩 함수 inner를 반환함  </span>
<span class="token comment">//그리고 outer 함수의 실행 컨텍스트는 실행 컨텍스트 스택에서 팝되어 제거됨</span>
<span class="token keyword">const</span> innerFunc <span class="token operator">=</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">innerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol><li><p>outer 함수가 평가되어 함수 객체 생성 시 현재 실행 중인 실행 컨텍스트의 렉시컬 환경 (전역 렉시컬 환경)을<br>
outer 함수 객체의 [[Environment]] 내부 슬롯에 상위 스코프로서 저장함</p></li> <li><p>outer 함수 호출 시 outer 함수의 렉시컬 환경이 생성되고 앞서 outer 함수 객체의 [[Environment]]<br>
내부 슬롯에 저장된 전역 렉시컬 환경을 outer 함수 렉시컬 환경의 '외부 렉시컬 환경에 대한 참조'에 할당함</p></li> <li><p>중첩 함수 inner가 평가됨 (inner 함수는 함수 표현식으로 정의했으므로 런타임에 평가됨)<br>
중첩 함수 inner는 [[Environment]] 내부 슬롯에 현재 실행중인 실행 컨텍스트 렉시컬 환경<br>
(outer 함수의 렉시컬 환경)을 상위 스코프로서 저장함</p></li> <li><p>outer 함수의 실행이 종료하면 inner 함수를 반환하면서 outer 함수의 생명 주기가 종료되며<br>
outer 함수의 실행 컨텍스트가 실행 컨텍스트 스택에서 제거됨</p> <p>하지만 outer 함수의 렉시컬 환경은 inner 함수의 [[Environment]] 내부 슬롯에 의해<br>
참조되고 있고 inner 함수는 전역 변수 innerFunc에 의해 참조되고 있기 때문에<br>
가비지 컬렉션의 대상이 되지 않으므로 outer 함수의 렉시컬 환경은 소멸하지 않음</p></li> <li><p>outer 함수가 반환한 inner 함수 호출 시 inenr 함수의 실행 컨텍스트가 생성되고 실행 컨텍스트 스택에 푸쉬됨<br>
렉시컬 환경의 외부 렉시컬 환경에 대한 참조에는 inner 함수 객체의 [[Environment]] 내부 슬롯에<br>
저장되어 있는 참조값이 할당됨</p></li></ol> <hr> <p>외부 함수보다 더 오래 생존한 중첩 함수는 외부 함수의 생존 여부(실행 컨텍스트의 생존 여부)와<br>
상관없이 자신이 정의된 위치에 의해 결정된 상위 스코프를 기억함<br>
중첩 함수 내부에서 상위 스코프를 참조 가능하므로 상위 스코프의 식별자를 참조 가능하고 값을 변경할 수도 있음</p> <p>자바스크립트의 모든 함수는 상위 스코프를 기억하므로 이론적으로 모든 함수는 클로저이지만<br>
일반적으로 모든 함수를 클로저라고는 하지 않음</p> <ul><li><p><strong>상위 스코프의 어떤 식별자도 참조하지 않는 함수는 클로저가 아님</strong><br>
상위 스코프의 어떤 식별자도 참조하지 않는 경우 대부분의 모던 브라우저는<br>
메모리 낭비를 막기 위해 최적화를 통해 상위 스코프를 기억하지 않음</p></li> <li><p><strong>외부 함수보다 중첩 함수의 생명 주기가 짧은 경우 클로저가 아님</strong><br>
중첩 함수가 외부 함수보다 일찍 소멸되기 때문에 생명 주기가 종료된 외부 함수의<br>
식별자를 참조할 수 있다는 클로저의 본질에 부합하지 않음</p></li> <li><p><strong>클로저는 중첩 함수가 상위 스코프의 식별자를 참조하고 있고<br>
중첩 함수가 외부 함수보다 더 오래 유지되는 경우에 한정하는 것이 일반적</strong></p></li> <li><p>클로저는 상위 스코프를 기억해야 하므로 불필요한 메모리의 점유를 걱정할 수 있지만<br>
모던 자바스크립트 엔진은 최적화가 잘 되어 있어 클로저가 참조하지 않는 식별자는 기억하지 않음<br>
즉, 상위 스코프의 식별자 중 기억해야 할 식별자만 기억함</p> <p><strong>자유 변수</strong> : 클로저에 의해 참조되는 상위 스코프의 변수<br> <strong>클로저</strong> : 자유변수에 묶여 있는 함수</p></li></ul> <p>클로저는 자바스크립트의 강력한 기능.<br>
필요한 상황에 적극적으로 이용하는 것을 권장함</p> <h2 id="_4-클로저의-활용"><a href="#_4-클로저의-활용" class="header-anchor">#</a> 4. 클로저의 활용</h2> <p><strong>클로저는 상태를 안전하게 변경하고 유지하기 위해 사용함</strong><br>
즉, 상태가 의도치 않게 변경되지 않도록 상태를 안전하게 은닉하고<br>
특정 함수에게만 상태 변경을 허용해 상태를 안전하게 변경하고 유지하기 위함</p> <h3 id="예제-1"><a href="#예제-1" class="header-anchor">#</a> 예제 1</h3> <h4 id="예제-1-1"><a href="#예제-1-1" class="header-anchor">#</a> 예제 1-1</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//카운트 상태 변수</span>
<span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">//카운트 상태 변경 함수</span>
<span class="token keyword">const</span> <span class="token function-variable function">increase</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//카운트 상태를 1만큼 증가시킴</span>
    <span class="token keyword">return</span> <span class="token operator">++</span>num<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//3</span>
</code></pre></div><p>해당 코드는 잘 동작하지만 바르게 동작하려면 아래 전제 조건이 지켜져야 하기 떄문에<br>
오류를 발생시킬 가능성을 안고 있음</p> <ul><li>카운트 상태는 increase 함수가 호출되기 전까지 변경되지 않고 유지되어야 함</li> <li>이를 위해 카운트 상태는 increase 함수만이 변경할 수 있어야 함</li></ul> <h4 id="예제-1-2"><a href="#예제-1-2" class="header-anchor">#</a> 예제 1-2</h4> <p>카운트 상태를 안전하게 변경하고 유지하기 위해 increase 함수만이 num 변수를 참조하고 변경 가능하도록<br>
전역 변수 num을 increase 함수의 지역 변수를 바꾸어 의도치 않은 상태 변경을 방지함</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//카운트 상태 변경 함수</span>
<span class="token keyword">const</span> <span class="token function-variable function">increase</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//카운트 상태 변수</span>
    <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">//카운트 상태를 1만큼 증가시킴</span>
    <span class="token keyword">return</span> <span class="token operator">++</span>num<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
</code></pre></div><p>하지만 increase 함수 호출 시마다 지역 변수는 다시 선언되고 0으로 초기화되기 떄문에<br>
상태가 변경되기 이전 상태를 유지하지 못함</p> <h4 id="예제-1-3"><a href="#예제-1-3" class="header-anchor">#</a> 예제 1-3</h4> <p>이전 상태를 유지할 수 있도록 클로저를 사용</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//카운트 상태 변경 함수</span>
<span class="token keyword">const</span> increase <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//카운트 상태 변수</span>
    <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">//클로저</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//카운트 상태를 1만큼 증가시킴</span>
        <span class="token keyword">return</span> <span class="token operator">++</span>num<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//3</span>
</code></pre></div><ul><li><p>코드 실행 시 즉시 실행 함수가 호출되고 즉시 실행 함수가 반환한 함수가 increase 변수에 할당됨<br>
increase 변수에 할당된 함수는 상위 스코프인 즉시 실행 함수의 렉시컬 환경을 기억하는 클로저</p></li> <li><p>즉시 실행 함수는 호출된 이후 소멸하지만 즉시 실행 함수가 반환한 클로저는 increase 변수에 할당되어 호출됨<br>
즉시 실행 함수가 반환한 클로저는 자유 변수 num을 참조하고 변경할 수 있음</p></li> <li><p>즉시 실행 함수는 한 번만 실행되므로 increase가 호출될 때마다 num 변수가 재차 초기화될 일 없음<br>
또한 num 변수는 외부에서 직접 접근 불가능한 은닉된 private 변수이므로<br>
의도치 않은 변경을 걱정하지 않아도 되며 더 안정적인 프로그래밍이 가능함</p></li></ul> <h3 id="예제-2"><a href="#예제-2" class="header-anchor">#</a> 예제 2</h3> <h4 id="예제-2-1"><a href="#예제-2-1" class="header-anchor">#</a> 예제 2-1</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//카운트 상태 변수</span>
    <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">//클로저란 메서드를 갖는 객체를 반환함</span>
    <span class="token comment">//객체 리터럴은 스코프를 만들지 않음</span>
    <span class="token comment">//따라 아래 메서드들의 상위 스코프는 즉시 실행 함수의 렉시컬 환경</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment">//num: 0, //프로퍼티는 public하므로 은닉되지 않음</span>
        <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">++</span>num<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> num <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token operator">--</span>num <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>
</code></pre></div><ul><li><p>즉시 실행 함수가 반환하는 객체 리터럴은 즉시 실행 함수의 실행 단계에서 평가되어 객체가 됨<br>
이때 객체의 메서드도 함수 객체로 생성됨<br>
객체 리터럴의 중괄호는 코드 블록이 아니므로 별도의 스코프를 생성하지 않음</p></li> <li><p>increase, decrease 메서드의 상위 스코프는 해당 메서드가 평가되는 시점에 실행 중인<br>
실행 컨텍스트(즉시 실행 함수 실행 컨텍스트)의 렉시컬 환경.<br>
따라 increase, decrease 함수는 즉시 실행 함수의 스코프의 식별자를 참조 가능함</p></li></ul> <h4 id="예제-2-2"><a href="#예제-2-2" class="header-anchor">#</a> 예제 2-2</h4> <p>위 예제를 생성자 함수로 표현하면 아래와 같음</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Counter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//카운트 상태 변수</span>
    <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//this.num = 0; //프로퍼티는 public하므로 은닉되지 않음</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">Counter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">increase</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">++</span>num<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name">Counter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">decrease</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> num <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token operator">--</span>num <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> Counter<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span><span class="token function">decrease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>
</code></pre></div><ul><li><p>num 변수는 생성자 함수가 생성할 인스턴스의 프로퍼티가 아닌 즉시 실행 함수 내에서 선언된 변수<br>
해당 변수는 인스턴스를 통해 접근 불가능하며 즉시 실행 함수 외부에서도 접근 불가능한 은닉된 변수.<br>
만약 num 변수가 생성자 함수가 생성할 인스턴스의 프로퍼티라면<br>
인스턴스를 통해 외부에서 접근 가능한 public 프로퍼티가 됨</p></li> <li><p>생성자 함수 Counter는 프로토타입을 통해 increase, decrease 메서드를 상속받는 인스턴스를 생성함<br>
두 메서드는 모두 즉시 실행 함수 실행 컨텍스트의 렉시컬 환경을 기억하는 클로저.<br>
따라 프로토타입을 통해 상속되는 프로토타입 메서드라도 즉시 실행 함수의 자유 변수 num을 참조 가능함</p></li></ul> <p>이처럼 클로저는 외부 상태 변경이나 가변 데이터를 피하고 불변성을 지향하는 함수형 프로그래밍에서<br>
부수 효과를 최대한 억제하여 오류를 피하고 프로그램의 안정성을 높이기 위해 적극적으로 사용됨</p> <h3 id="예제-3"><a href="#예제-3" class="header-anchor">#</a> 예제 3</h3> <p>다음은 함수형 프로그래밍에서 클로저를 활용하는 간단한 예제</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//함수를 인수로 전달받고 함수를 반환하는 고차 함수</span>
<span class="token comment">//이 함수는 카운트 상태를 유지하기 위한 자유 변수 counter를 기억하는 클로저를 반환함</span>
<span class="token keyword">function</span> <span class="token function">makeCounter</span><span class="token punctuation">(</span><span class="token parameter">aux</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//카운트 상태를 유지하기 위한 자유 변수</span>
    <span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">//클로저를 반환</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//인수로 전달받은 보조 함수에 상태 변경을 위임함</span>
        counter <span class="token operator">=</span> <span class="token function">aux</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> counter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//보조 함수</span>
<span class="token keyword">function</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">++</span>n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">--</span>n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//함수로 함수를 생성함</span>
<span class="token comment">//makeCounter 함수는 보조 함수를 인수로 전달받아 함수를 반환함</span>
<span class="token keyword">const</span> increaser <span class="token operator">=</span> <span class="token function">makeCounter</span><span class="token punctuation">(</span>increase<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">increaser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">increaser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2</span>

<span class="token comment">//increaser 함수와는 별개로 독립된 렉시컬 환경을 갖기 때문에 카운터 상태가 연동되지 않음</span>
<span class="token keyword">const</span> decreaser <span class="token operator">=</span> <span class="token function">makeCounter</span><span class="token punctuation">(</span>decrease<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">decreaser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//-1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">decreaser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//-2</span>
</code></pre></div><ul><li><p>makeCounter 함수는 보조 함수를 인자로 전달받고 함수를 반환하는 고차 함수<br>
makeCounter 함수가 반환하는 함수는 자신이 생성됐을 때의 렉시컬 환경인<br>
makeCounter 함수의 스코프에 속한 counter 변수를 기억하는 클로저</p></li> <li><p>makeCounter 함수는 인자로 전달받은 보조 함수를 합성해 자신이 반환하는 함수의 동작을 변경할 수 있음<br>
주의해야 할 것은 makeCounter 함수를 호출해 함수를 반환할 때 반환된 함수는<br>
자신만의 독립된 렉시컬 환경을 갖는다는 것.<br>
이는 함수 호출 시마다 새로운 makeCounter 함수 실행 컨텍스트의 렉시컬 환경이 생성되기 때문</p></li> <li><p>makeCounter 함수 호출 시 makeCounter 함수의 실행 컨텍스트가 생성됨<br>
makeCounter 함수는 함수 객체를 생성해 반환한 후 소멸됨<br>
makeCounter 함수가 반환한 함수는 makeCounter 함수의 렉시컬 환경을 상위 스코프로서 기억하는 클로저이며,<br>
전역 변수인 increaser에 할당됨<br>
이 때 makeCounter 함수의 실행 컨텍스트는 소멸되지만 makeCounter 함수 실행 컨텍스트의 렉시컬 환경은<br>
makeCounter 함수가 반환한 함수의 [[Environment]] 내부 슬롯에 의해 참조되고 있기 때문에 소멸하지 않음</p></li> <li><p>makeCounter 함수 호출 시 새로운 makeCounter 함수의 실행 컨텍스트가 실행되며<br>
위의 과정과 똑같은 과정을 거쳐 전역 변수인 decreaser에 할당됨</p></li> <li><p>전역 변수 increaser와 decreaser에 할당된 함수는 각각 자신만의 독립된 렉시컬 환경을 갖기 때문에<br>
카운트를 유지하기 위한 자유변수 counter를 공유하지 않아 카운터의 증감이 연동되지 않음<br>
따라 독립된 카운터가 아니라 연동해 증감이 가능한 카운터를 만들려면 렉시컬 환경을<br>
공유하는 클로저를 만들어야 하며 이를 위해서는 makeCounter 함수를 두 번 호출하지 말아야 함</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//함수를 반환하는 고차 함수</span>
<span class="token comment">//이 함수는 카운트 상태를 유지하기 위한 자유 변수 counter를 기억하는 클로저를 반환함</span>
<span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//카운트 상태를 유지하기 위한 자유 변수</span>
  <span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">//함수를 인수로 전달받는 클로저를 반환</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">aux</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//인수로 전달받은 보조 함수에 상태 변경을 위임함</span>
    counter <span class="token operator">=</span> <span class="token function">aux</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> counter<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//보조 함수</span>
<span class="token keyword">function</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">++</span>n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">decrease</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">--</span>n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//보조 함수를 전달해 호출</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">counter</span><span class="token punctuation">(</span>increase<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">counter</span><span class="token punctuation">(</span>increase<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2</span>
<span class="token comment">//자유 변수를 공유함</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">counter</span><span class="token punctuation">(</span>decrease<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">counter</span><span class="token punctuation">(</span>decrease<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>
</code></pre></div><h2 id="_5-캡슐화와-정보-은닉"><a href="#_5-캡슐화와-정보-은닉" class="header-anchor">#</a> 5. 캡슐화와 정보 은닉</h2> <ul><li><strong>캡슐화</strong> <ul><li>객체의 상태를 나타내는 프로퍼티와 프로퍼티를 참조하고 동작할 수 있는 동작인 메서드를 하나로 묶는 것</li> <li>객체의 특정 프로퍼티나 메서드를 감출 목적으로 사용하기도 함 (=정보 은닉)</li></ul></li> <li><strong>정보 은닉</strong> <ul><li>외부에 공개할 필요가 없는 구현의 일부를 외부에 공개되지 않도록 감추어<br>
적절치 못한 접근으로부터 객체의 상태가 변경되는 것을 방지해 정보를 보호하는 것</li> <li>객체 간의 상호 의존성(=결합도)를 낮추는 효과가 있음</li></ul></li></ul> <p>대부분의 객체지향 프로그래밍 언어는 클래스를 정의하고 클래스를 구성하는 멤버(프로퍼티와 메서드)에 대해<br>
접근 제한자(public, private, protected)를 선언해 공개 범위를 한정할 수 있음<br>
public으로 선언된 프로퍼티와 메서드 : 클래스 외부에서 참조 가능<br>
private으로 선언된 프로퍼티와 메서드 : 클래스 외부에서 참조 불가능</p> <p>자바스크립트는 접근 제한자를 제공하지 않음<br>
따라 자바스크립트 객체의 모든 프로퍼티와 메서드는 기본적으로 외부에 공개되어 있음 (public)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> <span class="token comment">//public</span>
  <span class="token keyword">let</span> _age <span class="token operator">=</span> age<span class="token punctuation">;</span> <span class="token comment">//private</span>
  
  <span class="token comment">//인스턴스 메서드</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hi My name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. I am </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> me <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Leo'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
me<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Hi! My name is Leo. I am 20.</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>me<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Leo</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>me<span class="token punctuation">.</span>_age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
</code></pre></div><ul><li>예제의 name 프로퍼티는 외부로 공개되어 있어 자유롭게 참조하거나 변경할 수 있음<br>
(name 프로퍼티는 public함)</li> <li>_age 변수는 Person 생성자 함수의 지역 변수이므로 Person 생성자 함수 외부에서 참조하거나 변경할 수 없음<br>
(_age 변수 = private함)</li></ul> <p>위 예제의 sayHi 메서드는 인스턴스 메서드이므로 Person 객체가 생성될 때마다 중복 생성됨<br>
sayHi 메서드를 프로토타입 메서드로 변경해 sayHi 메서드의 중복 생성을 방지함</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> <span class="token comment">//public</span>
  <span class="token keyword">let</span> _age <span class="token operator">=</span> age<span class="token punctuation">;</span> <span class="token comment">//private</span>
<span class="token punctuation">}</span>

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//Person 생성자 함수의 지역 변수 _age를 참조 불가능</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hi My name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. I am </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Person.prototype.sayHi 메서드 내에서 Person 생성자 함수의 _age 지역 변수를 참조할 수 없는 문제 발생<br>
따라 즉시 실행 함수를 이용해 Person 생성자 함수와 Person.prototype.sayHi 메서드를 하나의 함수로 모음</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Person <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _age <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//private</span>

  <span class="token comment">//생성자 함수</span>
  <span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> <span class="token comment">//public</span>
    _age <span class="token operator">=</span> age<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">//프로토타입 메서드</span>
  <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hi My name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. I am </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_age<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token comment">//생성자 함수를 반환</span>
  <span class="token keyword">return</span> Person<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> me <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Leo'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
me<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Hi! My name is Leo. I am 20.</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>me<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Leo</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>me<span class="token punctuation">.</span>_age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
</code></pre></div><p>이렇게 사용하면 접근 제한자를 제공하지 않는 자바스크립트에서도 정보 은닉이 가능한 것처럼 보임<br>
즉시 실행 함수가 반환하는 Person 생성자 함수와 Person 생성자 함수의 인스턴스가 상속받아<br>
호출할 Person.prototype.sayHi 메서드는 즉시 실행 함수가 종료된 이후 호출되지만<br>
이미 종료되어 소멸한 즉시 실행 함수의 지역 변수 _age를 참조할 수 있는 클로저임</p> <p>하지만 Person 생성자 함수가 여러개의 인스턴스를 생성할 경우 _age 변수의 상태가 유지되지 않는 문제가 생김</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> me <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Leo'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
me<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Hi! My name is Leo. I am 20.</span>

<span class="token keyword">const</span> you <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Park'</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
you<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Hi! My name is Park. I am 23.</span>

<span class="token comment">//_age 변수 값이 변경됨</span>
me<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Hi! My name is Leo. I am 23.</span>
</code></pre></div><p>이는 Person.prototype.sayHi 메서드가 단 한번 생성되는 클로저이기 때문에 발생하는 현상</p> <p>Person.prototype.sayHi 메서드는 즉시 실행 함수가 호출될 때 생성됨<br>
이때 해당 메서드는 자신의 상위 스코프인 즉시 실행 함수의 실행 컨텍스트의<br>
렉시컬 환경의 참조를 [[Environment]]에 저장함</p> <p>따라 Person.prototype.sayHi 메서드는 어떤 인스턴스로 호출해도 하나의 동일한 상위 스코프를 사용하게 됨<br>
이런 이유로 Person 생성자 함수가 여러 개의 인스턴스를 생성할 경우 _age 변수의 상태가 유지되지 않음</p> <p>이처럼 자바스크립트는 정보 은닉을 완전하게 지원하지 않음<br>
인스턴스 메서드를 사용한다면 자유 변수를 통해 private를 흉내낼 수 있지만<br>
프로토타입 메서드를 사용하면 이마저도 불가능함<br>
ES6의 Symbol 또는 WeakMap을 사용해 private한 프로퍼티를 흉내낼 수 있으나 근본적인 해결책은 아님</p> <p>다행히 2021년 1월 TC39 프로세스의 stage 3에서 클래스에 private 필드를 정의할 수 있는<br>
새로운 표준 사양이 제안되어 있으며 표준 사양으로 승급이 확실한 이 제안은<br>
최신 브라우저(Chrome 74  이상)와 최신 Node.js(v12 이상)에 이미 구현되어 있음</p> <h2 id="_6-자주-발생하는-실수"><a href="#_6-자주-발생하는-실수" class="header-anchor">#</a> 6. 자주 발생하는 실수</h2> <p>아래는 클로저 사용 시 자주 발생할 수 있는 실수를 보여주는 예제</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> funcs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  funcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> i<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> funcs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>funcs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>첫 번째 for 문의 코드 블록 내에서 함수가 funcs 배열의 요소로 추가됨<br>
두 번째 for 문의 코드 블록 내에서 funcs 배열의 요소로 추가된 함수를 순차적으로 호출함<br>
이때 funcs 배열의 요소로 추가된 3개의 함수가 0,1,2를 반환할 것으로 기대했지만 결과는 다름</p> <p>for 문의 변수 선언문에서 var 키워드로 선언한 i 변수는 함수 레벨 스코프를 갖기 때문에 전역 변수임<br>
전역 변수 i에는 0,1,2가 순차적으로 할당됨<br>
따라 funcs 배열의 요소로 추가한 함수를 호출하면 전역 변수 i를 참조해 i의 값 3이 출력됨</p> <p>클로저를 사용해 위 예제를 바르게 동작하는 코드로 만듬</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> funcs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  funcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> funcs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>funcs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>즉시 실행 함수는 전역 변수 i에 현재 할당되어 있는 값을 인수로 전달받아<br>
매개변수 id에 할당한 후 중첩 함수를 반환하고 종료함<br>
즉시 실행 함수가 반환한 함수는 funcs 배열에 순차적으로 저장됨</p> <p>이때 즉시 실행 함수의 매개변수 id는 즉시 실행 함수가 반환한 중첩 함수의<br>
상위 스코프(즉시 실행 함수의 렉시컬 환경)에 존재함<br>
즉시 실행 함수가 반환한 중첩 함수는 자신의 상위 스코프를 기억하는 클로저이고,<br>
매개변수 id는 즉시 실행 함수가 반환한 중첩 함수에 묶여 있는 자유 변수가 되어 값이 유지됨</p> <p>이 예제는 자바스크립트 함수 레벨 스코프 특성으로 인해 발생하는 현상<br>
ES6의 let 키워드를 사용하면 이 같은 번거로움이 깔끔하게 해결됨</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> funcs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  funcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> i<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> funcs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>funcs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>for 문의 변수 선언문에서 let 변수를 사용하면 for 문의 코드 블록이<br>
반복 실행될 때마다 for 문 코드 블록의 새로운 렉시컬 환경이 생성됨</p> <p>만약 for 문의 코드 블록 내에서 정의한 함수가 있다면 이 함수의 상위 스코프는<br>
for 문의 코드 블록이 반복 실행될 때마다 생성된 for 문 코드 블록의 새로운 렉시컬 환경</p> <p>이때 함수의 상위 스코프는 for 문의 코드 블록이 반복 실행될 때마다<br>
식별자(for 문의 변수 선언문에서 초기화 변수, for 문의 코드 블록 내 지역 변수 등)의 값을 유지해야 함<br>
이를 위해 for 문이 반복될 때마다 독립적인 렉시컬 환경을 생성해 식별자의 값을 유지함</p> <ol><li><p>for 문의 변수 선언문에서 let 초기화 변수를 사용한 for 문이 평가되면<br>
먼저 새로운 렉시컬 환경을 생성하고 초기화 변수 식별자와 값을 등록함<br>
그리고 새롭게 생성된 렉시컬 환경을 현재 실행 중인 실행 컨텍스트의 렉시컬 환경으로 교체함</p></li> <li><p>for 문의 코드 블록이 반복 실행되기 시작하면 새로운 렉시컬 환경을 생성하고 코드 블록 내의 식별자와 값을 등록함<br>
그리고 새롭게 생성된 렉시컬 환경을 현재 실행 중인 실행 컨텍스트의 렉시컬 환경으로 교체함</p></li> <li><p>for 문의 코드 블록의 반복 실행이 모두 종료되면 for 문이 실행되기 이전의 렉시컬 환경을<br>
실행 중인 실행 컨텍스트의 렉시컬 환경으로 되돌림</p></li></ol> <p>이처럼 let/const 키워드를 사용하는 반복문은 코드 블록을 반복 실행할 때마다<br>
새로운 렉시컬 환경을 생성해 반복할 당시의 상태를 마치 스냅숏을 찍는 것처럼 저장함<br>
단, 이는 반복문의 코드 블록 내부에서 함수를 정의할 때 의미 있음<br>
반복문의 코드 블록 내부에 함수 정의가 없는 반복문이 생성하는 새로운 렉시컬 환경은<br>
반복 직후 아무도 참조하지 않기 떄문에 가비지 컬렉션의 대상이 됨</p> <p>또 다른 방법으로는 함수형 프로그래밍 기법인 고차 함수를 사용하는 방법이 있음<br>
이 방법은 변수와 반복문의 사용을 억제할 수 있기 떄문에 오류를 줄이고 가독성을 좋게 만듬</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//요소가 3개인 배열을 생성하고 배열의 인덱스를 반환하는 함수를 요소로 추가함</span>
<span class="token comment">//배열의 요소로 추가된 함수들은 모두 클로저</span>
<span class="token keyword">const</span> funcs <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//(3)[f,f,f]</span>

<span class="token comment">//배열의 요소로 추가된 함수들을 순차적으로 호출</span>
funcs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">f</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0 1 2</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/TIL/assets/js/app.9bee923c.js" defer></script><script src="/TIL/assets/js/2.e5153bce.js" defer></script><script src="/TIL/assets/js/66.8402813f.js" defer></script>
  </body>
</html>
